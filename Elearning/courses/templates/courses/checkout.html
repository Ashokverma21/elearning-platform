{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Checkout | E-Learning</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body {
        background: linear-gradient(135deg,#1f1c2c,#928dab);
        font-family: Poppins, sans-serif;
        min-height: 100vh;
        padding-top: 60px;
    }

    .checkout-card {
        max-width: 550px;
        margin: auto;
        background: rgba(255,255,255,0.15);
        padding: 25px;
        border-radius: 16px;
        backdrop-filter: blur(12px);
        box-shadow: 0 0 30px rgba(0,0,0,0.25);
        color: #fff;
        animation: fadeIn 0.9s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .pay-btn {
        width: 100%;
        background: #fff;
        color: #1f1c2c;
        font-weight: 600;
        border-radius: 10px;
        padding: 12px;
        transition: 0.3s;
    }

    .pay-btn:hover {
        background: #e6e6e6;
        transform: scale(1.02);
    }

    .thumbnail {
        border-radius: 12px;
        margin-bottom: 15px;
        width: 100%;
        height: 220px;
        object-fit: cover;
    }

    #loader {
        display: none;
        margin-top: 20px;
    }
</style>
</head>

<body>

<div class="checkout-card">

    <h2 class="fw-bold">Checkout</h2>
    <p>You're purchasing:</p>

    {% if course.thumbnail %}
    <img src="{{ course.thumbnail.url }}" class="thumbnail">
    {% elif course.video %}
    <video class="thumbnail" autoplay muted loop>
        <source src="{{ course.video.url }}" type="video/mp4">
    </video>
    {% else %}
    <img src="{% static 'users/img/default.jpg' %}" class="thumbnail">
    {% endif %}

    <h3>{{ course.title }}</h3>
    <p class="mt-2">{{ course.description|truncatechars:150 }}</p>

    <h3 class="mt-3 fw-bold">â‚¹{{ course.price }}</h3>

    <button id="payBtn" class="btn pay-btn mt-4">Pay Now</button>

    <!-- Loader -->
    <div id="loader" class="text-center">
        <img src="https://cdn.dribbble.com/users/1186261/screenshots/3718681/media/520e139368b631dcc3f4d026c0ce6299.gif" width="120">
        <p class="mt-2">Processing payment...</p>
    </div>

</div>

<!-- Razorpay Script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
    var options = {
        "key": "{{ razorpay_key }}",
        "amount": "{{ amount }}",
        "currency": "INR",
        "name": "{{ course.title }}",
        "description": "Course Purchase",
        "order_id": "{{ order_id }}",

        "handler": function (response){
            // show loader
            document.getElementById("payBtn").style.display = "none";
            document.getElementById("loader").style.display = "block";

            // redirect to server success URL with payment info
            window.location.href = "/courses/payment-success/{{ course.id }}/"
                + "?razorpay_payment_id=" + response.razorpay_payment_id
                + "&razorpay_order_id=" + response.razorpay_order_id
                + "&razorpay_signature=" + response.razorpay_signature;
        },

        "theme": {
            "color": "#7c4dff"
        }
    };

    document.getElementById("payBtn").onclick = function (e) {
        var rzp1 = new Razorpay(options);
        rzp1.open();
        e.preventDefault();
    }
</script>

</body>
</html>
